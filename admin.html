<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø±ÙƒØ² Ø¨Ø« Ø³Ø¨ÙŠØ³ØªÙˆÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ…</title>
    <style>
        :root {
            --space-blue: #0a114d;
            --stoon-blue: #182694;
            --stoon-gold: #ffd700;
            --stoon-green: #3dfc4a;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--space-blue); 
            background: radial-gradient(circle, #1e2a78 0%, #0a114d 100%);
            color: white; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            overflow-x: hidden;
        }

        .card { 
            background: var(--stoon-blue); 
            padding: 40px; 
            border-radius: 25px; 
            width: 450px; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 15px rgba(255,255,255,0.1); 
            border: 3px solid var(--stoon-gold); 
            text-align: center;
            position: relative;
        }

        h2 { 
            color: var(--stoon-gold); 
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            font-size: 28px;
            margin-bottom: 30px;
        }

        input, button, textarea { 
            width: 100%; 
            margin-top: 15px; 
            padding: 14px; 
            border-radius: 12px; 
            border: 2px solid rgba(255,255,255,0.2); 
            box-sizing: border-box; 
            font-size: 16px;
            outline: none;
            transition: 0.3s;
        }

        input, textarea { background: rgba(255, 255, 255, 0.9); color: #111; }
        input:focus { border-color: var(--stoon-gold); box-shadow: 0 0 10px var(--stoon-gold); }

        button { 
            background: var(--stoon-gold); 
            color: var(--stoon-blue); 
            font-weight: 900; 
            cursor: pointer; 
            border: none;
            box-shadow: 0 4px 0 #b39700;
        }

        button:hover { background: #fff; transform: translateY(-2px); box-shadow: 0 6px 0 #ccc; }
        button:active { transform: translateY(2px); box-shadow: 0 0 0; }

        .history-container {
            margin-top: 30px;
            text-align: right;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 15px;
            border: 1px dashed var(--stoon-gold);
        }

        .history-title { font-size: 14px; color: var(--stoon-gold); margin-bottom: 10px; border-bottom: 1px solid #444; }
        
        .msg-item {
            font-size: 13px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.5s ease;
        }
        .msg-user { color: var(--stoon-gold); font-weight: bold; }

        .admin-only { background: #ff4d4d !important; color: white !important; margin-top: 20px; display: none; box-shadow: 0 4px 0 #a32a2a; }
        .hidden { display: none; }
        #status { margin-top: 15px; color: var(--stoon-green); font-weight: bold; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

<div class="card">
    <h2>Ø´Ø±ÙŠØ· Ø°ÙƒØ±ÙŠØ§Øª Ø³Ø¨ÙŠØ³ØªÙˆÙ† ğŸš€</h2>
    
    <div id="auth-section">
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button onclick="handleAuth()" id="auth-btn">Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆÙƒØ¨</button>
        <p style="font-size: 12px; cursor: pointer; color: var(--stoon-gold);" onclick="toggleAuthMode()" id="toggle-text">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ø§Ù„Ø¢Ù†</p>
    </div>

    <div id="msg-section" class="hidden">
        <input type="text" id="nickname" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø³Ø¨ÙŠØ³ØªÙˆÙ†ÙŠ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù…Ø­Ù‚Ù‚ ÙƒÙˆÙ†Ø§Ù†)">
        <textarea id="msg" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù„ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©..."></textarea>
        <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø³Ø¨ÙŠØ³ØªÙˆÙ† âœ¨</button>
        
        <div class="history-container">
            <div class="history-title">Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©:</div>
            <div id="history-list"></div>
        </div>

        <button id="clear-btn" class="admin-only" onclick="clearMessages()">Ù…Ø³Ø­ Ø§Ù„Ø´Ø±ÙŠØ· (Ù„Ù„Ù…Ø´Ø±Ù)</button>
        <button onclick="logout()" style="background: transparent; color: #aaa; box-shadow: none; font-size: 11px; margin-top: 20px; border: 1px solid #444;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <p id="status"></p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAtO7mz0ZptyJKCBo1ouV420ej5bWC5VYY",
        databaseURL: "https://spacetoonold-aaac4-default-rtdb.firebaseio.com", 
        projectId: "spacetoonold-aaac4",
        storageBucket: "spacetoonold-aaac4.firebasestorage.app",
        appId: "1:511855750136:web:d353fa9309ac5e54a9040d"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let isLoginMode = true;

    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-btn').innerText = isLoginMode ? "Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆÙƒØ¨" : "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø³Ø¨ÙŠØ³ØªÙˆÙ†ÙŠ";
        document.getElementById('toggle-text').innerText = isLoginMode ? "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ø§Ù„Ø¢Ù†" : "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ";
    }

    async function handleAuth() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        try {
            if (isLoginMode) { await auth.signInWithEmailAndPassword(email, pass); }
            else { await auth.createUserWithEmailAndPassword(email, pass); }
        } catch (error) { alert("Ø®Ø·Ø£: " + error.message); }
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('msg-section').classList.remove('hidden');
            if (user.email === "aymanbouraaman@gmail.com") { // Change this to your email!
                document.getElementById('clear-btn').style.display = "block";
            }
            loadHistory();
        } else {
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('msg-section').classList.add('hidden');
        }
    });

    function sendMessage() {
        const nick = document.getElementById('nickname').value || "Ø¹Ø¶Ùˆ Ø³Ø¨ÙŠØ³ØªÙˆÙ†ÙŠ";
        const msgText = document.getElementById('msg').value;
        if(!msgText) return;

        const newMsg = { username: nick, text: msgText, timestamp: Date.now() };

        // 1. Update the live bar
        db.ref('latestMessage').set(newMsg);

        // 2. Add to history list (limited to 5)
        db.ref('history').push(newMsg);
        
        document.getElementById('status').innerText = "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ø´Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„! ğŸŒ ";
        document.getElementById('msg').value = "";
        setTimeout(() => { document.getElementById('status').innerText = ""; }, 3000);
    }

    function loadHistory() {
        db.ref('history').limitToLast(5).on('value', (snapshot) => {
            const list = document.getElementById('history-list');
            list.innerHTML = "";
            snapshot.forEach(child => {
                const data = child.val();
                const div = document.createElement('div');
                div.className = 'msg-item';
                div.innerHTML = `<span class="msg-user">${data.username}:</span> ${data.text}`;
                list.prepend(div);
            });
        });
    }

    function clearMessages() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) {
            db.ref('latestMessage').remove();
            db.ref('history').remove();
            alert("ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙˆÙƒØ¨!");
        }
    }

    function logout() { auth.signOut(); }
</script>
</body>
</html>
